"use strict";!function(){function t(t,e=-1){return BOXCoin.loading(t,e)}function e(t,e={},a=!1){return BOXCoin.ajax(t,e,a)}function a(t,e=!0){return BOXCoin.activate(t,e)}function n(t,e=!1){U.card(t,e)}function i(t){return BXC_TRANSLATIONS&&t in BXC_TRANSLATIONS?BXC_TRANSLATIONS[t]:t}function c(t,e=!1){U.error(t,e)}function r(t,e=-1){return t&&L(t).length()?(t=L(t).e[0],-1===e?L(t).is("checkbox")?t.checked:t.value.trim():(L(t).is("checkbox")?t.checked=0!=e&&e:t.value=e,void(L(t).is("textarea")&&b(t)))):""}function o(t){return L(t).find("input, select, textarea")}function s(){let t=window.location.href;if(t.includes("#")){let e=t.substr(t.indexOf("#"));if(e.includes("?")&&(e=e.substr(0,e.indexOf("?"))),e.length>1){let t=p.find(".bxc-nav "+e);if(t.length)return d(t),!0}}return!1}function d(n){if(!L(n).e.length)return;let i=p.find("main > div"),c=n.index();switch(v=L(i.e[c]),k=n.attr("id"),p.removeClass("bxc-area-transactions bxc-area-checkouts bxc-area-balances bxc-area-settings").addClass("bxc-area-"+k),a(i,!1),a(n.siblings(),!1),a(n),a(v),window.location.href.includes(k)||window.history.pushState("","","#"+k),k){case"transactions":t(v)||(t(v),$=0,g.find("tbody").html(""),N.print(()=>{t(i.e[c],!1)}));break;case"checkouts":v.hasClass("bxc-loading")&&e("get-checkouts",{},e=>{let a="";X=e;for(var n=0;n<e.length;n++)a+=T.row(e[n]);l(p.find("#bxc-table-checkouts tbody"),a),t(i.e[c],!1)});break;case"balances":U.balance(v);break;case"settings":v.hasClass("bxc-loading")&&e("get-settings",{},e=>{let a="";v.find(".bxc-btn-repater").e.forEach(t=>{let n=2;for(;t.parentElement.firstChild.id+"-"+n in e;)a+=h(t,!1,n),n++;a&&(a+=t.outerHTML.replace('"2"','"'+n+'"'),L(t).parent().append(a),t.remove())});for(var n in e){let t=p.find(`#${n}`);t&&r(o(t),e[n])}v.find("#btc-wallet-key input, #eth-wallet-key input").e.forEach(t=>{t.value&&(t.value="********")}),t(i.e[c],!1)})}}function l(t,e,a=!1){if(!e)return!t.html()&&t.html(`<p class="bxc-not-found">${i("There's nothing here yet.")}</p>`);t.find(".bxc-not-found").remove(),t.html((a?t.html():"")+e)}function u(){b(this)}function b(t){t.style.height="auto",t.style.height=t.scrollHeight+"px"}function h(t,e=!0,a=!1){let n=L(t).parent(),i=n.find("[data-type], hr"),c='<div class="bxc-repater-line"><hr /><i class="bxc-icon-close"></i></div>';a=a||parseInt(L(t).attr("data-index"));for(var r=0;r<i.e.length&&"HR"!=i.e[r].nodeName;r++){let t=L(i.e[r]).attr("id");c+=i.e[r].outerHTML.replace(t,t+"-"+a)}if(!e)return c;c+=t.outerHTML.replace('"'+a+'"','"'+(a+1)+'"'),t.remove(),n.append(c)}var f,p,x,m,v,k,g,C,w=[!1,!1,!1,!1],y={P:"Pending",C:"Completed",R:"Refunded",X:"Underpayment"},$=0,_=!0,B=new Date,X=!1,R=window.innerWidth<769,O=!1,L=window._query,N={get:function(t,a=!1,n=!1,i=!1,c=!1){e("get-transactions",{pagination:$,search:a,status:n,cryptocurrency:i,date_range:c},e=>{$++,t(e)})},print:function(t,e=w[0],a=w[1],n=w[2],c=w[3]){this.get(e=>{let a="";_=e.length;for(var n=0;n<_;n++){let t=e[n],c=t.from?`<a href="${U.explorer(t.cryptocurrency,t.from)}" target="_blank" class="bxc-link">${t.from}</a>`:"",r=t.currency.toUpperCase()+" "+t.amount_fiat,o="",s=t.description.replace(/\[|\]|"/g,"");t.vat_details&&(o=JSON.parse(t.vat_details),o=` data-vat="${t.currency} ${o.amount} (${o.percentage}%, ${o.country})"`),a+=`<tr data-id="${t.id}" data-title="${t.title}" data-cryptocurrency="${t.cryptocurrency}" data-hash="${t.hash}" data-notes="${s.replace(/,/g,"<br>")}" data-status="${t.status}"${t.billing?' data-invoice="true"':""}${o}><td class="bxc-td-id">${t.id}</td><td class="bxc-td-time"><div class="bxc-title">${BOXCoin.beautifyTime(t.creation_time,!0)}</div></td><td class="bxc-td-from">${c}</td><td class="bxc-td-to">${t.to?`<a href="${U.explorer(t.cryptocurrency,t.to)}" target="_blank" class="bxc-link">${t.to}</a>`:""}</td><td class="bxc-td-status"><span class="bxc-status-${t.status}">${i(y[t.status])}</span></td><td class="bxc-td-amount"><div class="bxc-title">${t.amount?t.amount+" "+BOXCoin.baseCode(t.cryptocurrency.toUpperCase()):r}</div><div class="bxc-text">${t.amount?r:BOXCoin.baseCode(t.cryptocurrency)}</div></td><td><i class="bxc-transaction-menu-btn bxc-icon-menu"></i></td></tr>`}l(g.find("tbody"),a,!0),t&&t(e)},e,a,n,c)},query:function(e=!1){t(g)||(g.find("tbody").html(""),$=0,w[0]=L(p).find("#bxc-search-transactions").val().toLowerCase().trim(),w[1]=L(p).find("#bxc-filter-status li.bxc-active").attr("data-value"),w[2]=L(p).find("#bxc-filter-cryptocurrency li.bxc-active").attr("data-value"),w[3]=!!O&&O.getDates("yyyy-mm-dd"),this.print(()=>{e&&t(e,!1),t(g,!1)}))},download:function(t){e("download-transactions",{search:w[0],status:w[1],cryptocurrency:w[2],date_range:w[3]},e=>{t(e)})}},T={row:function(t){return`<tr data-checkout-id="${t.id}"><td><div class="bxc-title"><span>${t.id}</span><span>${t.title}</span></div></td><td><div class="bxc-text">${t.currency?t.currency:BXC_CURRENCY} ${t.price}</div></td></tr>`},embed:function(t=!1){let e=C?3:2;for(var a=0;a<e;a++){let e=v.find("#bxc-checkout-"+(0==a?"payment-link":1==a?"embed-code":"shortcode")).find("div, i");if(t){let n=0==a?`${BXC_URL}pay.php?checkout_id=${t}${BXC_CLOUD.cloud?"&cloud="+BXC_CLOUD.cloud:""}`:1==a?`<div data-boxcoin="${t}"></div>${BXC_CLOUD.cloud?' <script id="boxcoin" src="'+BXC_URL+"js/client.js?cloud="+BXC_CLOUD.cloud+'"><\/script>':""}`:`[boxcoin id="${t}"]`;L(e.e[0]).html(n.replace(/</g,"&lt;")),L(e.e[1]).attr("data-text",window.btoa(n))}else L(e.e[0]).html(""),L(e.e[1]).attr("data-text","")}},get:function(t,e=!1){for(var a=0;a<X.length;a++)if(t==X[a].id)return e?(X.splice(a,1),!0):X[a];return!1}},U={active_element:!1,card:function(t,e=!1){var a=p.find(".bxc-info-card");e?"error"==e?a.addClass("bxc-info-card-error"):a.addClass("bxc-info-card-info"):(a.removeClass("bxc-info-card-error bxc-info-card-warning bxc-info-card-info"),clearTimeout(x)),a.html(i(t)),x=setTimeout(()=>{a.html("")},5e3)},error:function(e,a=!1){window.scrollTo({top:0,behavior:"smooth"}),p.find(".bxc-info").html(e),a&&t(a,!1)},balance:function(a){if(!t(a)){let n=p.find("#bxc-table-balances tbody");if(!n.e.length)return;n.html()||a.addClass("bxc-loading-first"),e("get-balances",{},e=>{let i="",c=e.balances;p.find("#bxc-balance-total").html(`${BXC_CURRENCY} ${e.total}`);for(var r in c){i+=`<tr data-cryptocurrency="${r}"><td><div class="bxc-flex"><img src="${r in e.token_images?e.token_images[r]:`${BXC_URL}media/icon-${r}.svg`}" /> ${c[r].name}${BOXCoin.network(r)}</div></td><td><div class="bxc-balance bxc-title">${c[r].amount} ${BOXCoin.baseCode(r).toUpperCase()}</div><div class="bxc-text">${BXC_CURRENCY} ${c[r].fiat}</div></td></tr>`}i?n.html(i):n.parent().html('<p class="bxc-text">Add your addresses from the Settings area.</p>'),a.removeClass("bxc-loading-first"),t(a,!1)})}},explorer:function(t,e,a="address"){let n="",i="address"==a?"address":["ltc","usdt_tron"].includes(t)?"transaction":"tx";switch(t){case"btc":n="https://www.blockchain.com/btc/{R}/{V}";break;case"eth":n="https://www.blockchain.com/eth/{R}/{V}";break;case"doge":n="https://dogechain.info/{R}/{V}";break;case"link":case"bat":case"shib":case"usdc":case"usdt":n="https://etherscan.io/{R}/{V}#tokentxns";break;case"usdt_tron":n="https://tronscan.org/#/{R}/{V}";break;case"algo":n="https://algoexplorer.io/{R}/{V}";break;case"stripe":n="https://dashboard.stripe.com/customers/{V}";break;case"verifone":n="https://secure.2checkout.com/cpanel/order_info.php?refno={V}";break;case"usdt_bsc":case"busd":case"bnb":n="https://bscscan.com/{R}/{V}";break;case"ltc":n="https://blockchair.com/litecoin/{R}/{V}";break;case"bch":n="https://www.blockchain.com/bch/{R}/{V}";break;case"xrp":i="address"==a?"accounts":"transactions",n="https://livenet.xrpl.org/{R}/{V}"}return n.replace("{R}",i).replace("{V}",e)}};window.BXCTransactions=N,window.BXCCheckout=T,window.BXCAdmin=U,document.addEventListener("DOMContentLoaded",()=>{if(f=L(document.body),(p=f.find(".bxc-main")).e.length){if(m=p.find("main > div"),v=m.e[0],g=p.find("#bxc-table-transactions"),C="undefined"!=typeof BXC_WP,BOXCoin.cookie("BXC_LOGIN")&&!p.hasClass("bxc-installation")){k="transactions",s()||N.print(()=>{t(v,!1)}),localStorage.getItem("bxc-cron")!=B.getDate()&&(e("cron",{domain:BXC_URL}),localStorage.setItem("bxc-cron",B.getDate()));let a=document.getElementsByTagName("textarea");for(let t=0;t<a.length;t++)a[t].setAttribute("style","height:"+a[t].scrollHeight+"px;overflow-y:hidden;"),a[t].addEventListener("input",u,!1);U.balance(p.find('main > [data-area="balance"]'))}g.on("click","tr",function(t){if(["A","I","LI"].includes(t.target.nodeName))return;let e=L(this).attr("data-hash");if(e){let t=L(this).attr("data-cryptocurrency"),a=U.explorer(t,e,"tx");a&&window.open(a)}}),p.on("click","#bxc-filters",function(){p.find(".bxc-nav-filters").toggleClass("bxc-active")}),p.on("click","#bxc-filter-date,#bxc-filter-date-2",function(){let t={maxNumberOfDates:2,maxDate:new Date,dateDelimiter:" - ",clearBtn:!0};O||(L.load(BXC_URL+"vendor/datepicker/datepicker.min.css",!1),L.load(BXC_URL+"vendor/datepicker/datepicker.min.js",!0,()=>{BXC_LANG?(t.language=BXC_LANG,L.load(`${BXC_URL}vendor/datepicker/locales/${BXC_LANG}.js`,!0,()=>{(O=new DateRangePicker(L(this).parent().e[0],t)).datepickers[0].show()})):(O=new DateRangePicker(L(this).parent().e[0],t)).datepickers[0].show()}))}),p.on("click","#bxc-filter-status li,#bxc-filter-cryptocurrency li, .datepicker-cell, .datepicker .clear-btn",function(){setTimeout(()=>{N.query()},100)}),p.on("click","#bxc-download-transitions",function(){t(this)||N.download(e=>{window.open(e),t(this,!1)})}),g.on("click",".bxc-transaction-menu-btn:not(.bxc-loading)",function(){let t=L(this).hasClass("bxc-active"),e=L(this.closest("tr")),n=`<ul class="bxc-transaction-menu bxc-ul"><li data-value="details">${i("Details")}</li>`,c=e.attr("data-status");if(a(g.find(".bxc-transaction-menu-btn"),!1),g.find(".bxc-transaction-menu").remove(),!t){a(this),e.attr("data-invoice")&&"C"==c&&(n+=`<li data-value="invoice">${i("Invoice")}</li>`),"P"==c&&(n+=`<li data-value="payment-link">${i("Payment link")}</li>`);for(var r in y)r!=c&&(n+=`<li data-value="${r}">${i("Mark as "+y[r].toLowerCase())}</li>`);L(this).parent().append(n+"</ul>")}}),g.on("click",".bxc-transaction-menu li",function(){let n=L(this.closest("tr")),c=n.find(".bxc-transaction-menu-btn");if(t(c))return;let r=L(this).attr("data-value"),o=n.attr("data-id");if(["C","P","R"].includes(r)&&e("update-transaction",{transaction_id:o,values:{status:r}},()=>{n.attr("data-status",r).find(".bxc-td-status span").attr("class","bxc-status-"+r).html(i(y[r])),t(c,!1)}),"invoice"!=r&&"payment-link"!=r||e(r,{transaction_id:o},e=>{window.open(e),t(c,!1)}),"details"==r){let e='<div class="bxc-text-list">',a=[["ID","id"],["Checkout","data-title"],["Hash","data-hash"],["Time","time"],["Notes","data-notes"],["Status","status"],["From","from"],["To","to"],["Amount","amount"],["VAT","data-vat"]];for(var s=0;s<a.length;s++){let t=a[s][1].includes("data")?n.attr(a[s][1]):n.find(".bxc-td-"+a[s][1]).html();t&&(e+=`<div><div>${i(a[s][0])}</div><div>${t}</div></div>`)}BOXCoin.lightbox("Transaction details",e),t(c,!1)}n.find(".bxc-ul").remove(),a(c,!1)}),p.on("click","#bxc-create-checkout, #bxc-table-checkouts td",function(){if(p.addClass("bxc-area-create-checkout"),L(this).is("td")){let e=L(this).parent().attr("data-checkout-id"),a=T.get(e);v.attr("data-checkout-id",e);for(var t in a){r(o(v.find(`#bxc-checkout-${t}`)),a[t])}T.embed(e)}else o(v).e.forEach(t=>{r(t,"")}),v.find("#bxc-checkout-type select").val("I"),v.attr("data-checkout-id",""),T.embed()}),p.on("click","#bxc-checkouts-list",function(){p.removeClass("bxc-area-create-checkout"),v.attr("data-checkout-id","")}),p.on("click","#bxc-save-checkout",function(){if(t(this))return;let a=!1,i={},o=v.find(".bxc-input"),s=v.attr("data-checkout-id");p.find(".bxc-info").html(""),o.removeClass("bxc-error"),o.e.forEach(t=>{let e=L(t).attr("id"),n=L(t).find("input, select"),c=r(n);!c&&n.length()&&n.e[0].hasAttribute("required")&&(a=!0,L(t).addClass("bxc-error")),i[e.replace("bxc-checkout-","")]=c}),a?c("Fields in red are required.",this):(s&&(i.id=s),e("save-checkout",{checkout:JSON.stringify(i)},e=>{t(this,!1),Number.isInteger(e)?(i.id=e,v.attr("data-checkout-id",e),v.find("#bxc-table-checkouts tbody").append(T.row(i)),T.embed(e),X.push(i),n("Checkout saved successfully")):!0===e?(T.get(s,!0),X.push(i),v.find(`tr[data-checkout-id="${s}"]`).replace(T.row(i)),n("Checkout saved successfully")):c(e,this.closest("form"))}))}),p.on("click","#bxc-delete-checkout",function(){if(t(this))return;let a=v.attr("data-checkout-id");e("delete-checkout",{checkout_id:a},()=>{t(this,!1),v.attr("data-checkout-id",""),v.find(`tr[data-checkout-id="${a}"]`).remove(),v.find("#bxc-checkouts-list").e[0].click(),n("Checkout deleted","error")})}),p.on("click","#bxc-save-settings",function(){if(t(this))return;let a={};p.find('[data-area="settings"]').find('.bxc-input[id]:not([data-type="multi-input"]),[data-type="multi-input"] [id]').e.forEach(t=>{a[L(t).attr("id")]=r(o(t))}),e("save-settings",{settings:JSON.stringify(a)},e=>{n(!0===e?"Settings saved":e,!0!==e&&"error"),t(this,!1)})}),p.on("click","#update-btn a",function(a){if(!t(this))return e("update",{domain:BXC_URL},e=>{!0===e?(n("Update completed. Reload in progress..."),setTimeout(()=>{location.reload()},500)):"latest-version-installed"==e?n("You have the latest version"):n(function(t){return(t=t.replace(/_/g," ").replace(/-/g," ")).charAt(0).toUpperCase()+t.slice(1)}(e),"error"),t(this,!1)}),a.preventDefault(),!1}),p.on("click","#email-test-btn a",function(a){if(!t(this))return e("email-test",{},e=>{!0===e&&n("Email successfully sent."),t(this,!1)}),a.preventDefault(),!1}),p.on("click",".bxc-btn-repater",function(){h(this)}),p.on("click",".bxc-repater-line i",function(){let t=L(this).parent(),e=Array.from(t.parent().e[0].childNodes),a=e.indexOf(t.e[0])+1,n=t.parent().find(".bxc-btn-repater");for(var i=a;i<e.length&&(!L(e[i]).hasClass("bxc-repater-line")&&!L(e[i]).hasClass("bxc-btn-repater"));i++)e[i].remove();n.attr("data-index",parseInt(n.attr("data-index"))-1),t.remove()}),R&&p.on("click",".bxc-icon-menu",function(){let t=L(this).parent();a(t,!t.hasClass("bxc-active"))}),p.on("click","#bxc-submit-installation",function(){if(t(this))return;let a=!1,n={},i=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,""),r=p.find(".bxc-input");if(r.removeClass("bxc-error"),p.find(".bxc-info").html(""),r.e.forEach(t=>{let e=L(t).attr("id"),i=L(t).find("input"),c=i.val().trim();!c&&i.e[0].hasAttribute("required")&&(a=!0,L(t).addClass("bxc-error")),n[e]=c}),a){a="Username, password and the database details are required.";let t=n.password;return t&&(t.length<8?a="Minimum password length is 8 characters.":t!=n["password-check"]&&(a="The passwords do not match.")),void c(a,this)}i.includes("?")&&(i=i.substr(0,i.indexOf("?"))),n.url=i+"/",e("installation",{installation_data:JSON.stringify(n)},t=>{!0===t?location.reload():c(t,this)})}),p.on("click",".bxc-nav > div",function(){d(L(this))}),p.on("click","#bxc-submit-login",function(){t(this)||e("login",{username:p.find("#username input").val().trim(),password:p.find("#password input").val().trim()},e=>{e?(BOXCoin.cookie("BXC_LOGIN",e,365,"set"),location.reload()):(p.find(".bxc-info").html("Invalid username or password."),t(this,!1))})}),p.on("click","#bxc-logout",function(){BOXCoin.cookie("BXC_LOGIN",!1,!1,"delete"),BOXCoin.cookie("BXC_CLOUD",!1,!1,"delete"),location.reload()}),p.on("click","#bxc-card",function(){L(this).html("")}),p.on("input",".bxc-search-input",function(){BOXCoin.search(this,(t,e)=>{"transactions"==k&&N.query(e,t)})}),p.on("click","#bxc-table-balances tr",function(){let t=L(this).attr("data-cryptocurrency"),e=U.explorer(t,BXC_ADDRESS[t]);e&&window.open(e)}),window.onscroll=function(){v&&(document.documentElement||document.body.parentNode||document.body).scrollTop+window.innerHeight==L.documentHeight()&&_&&"transactions"==k&&(L(v).find("> .bxc-loading-global").e.length||(N.print(()=>{window.scrollTo(0,document.body.scrollHeight-800),L(v).find("> .bxc-loading-global").remove()}),L(v).append('<div class="bxc-loading-global bxc-loading"></div>')))},window.onpopstate=function(){s()},document.addEventListener("click",function(t){U.active_element&&!U.active_element.contains(t.target)&&(a(U.active_element,!1),U.active_element=!1)})}})}();